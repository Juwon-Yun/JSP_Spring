<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 
	마이바티스는 쿼리 실행 시 파라미터를 치환함
	selectKey 전 : {{"title","제목"},{"category","카테고리"},{"price","10000"}}
	selectKey 후 : {{"title","제목"},{"category","카테고리"},{"price","10000"},{"bookId",2}}
	마이바티스 쿼리 XML에 전달되면 #{title}을 "제목"으로 자동 변환함
 -->
  <mapper namespace="book">
  		<!-- 리턴타입 생략함 -->
  		<insert id="insert" parameterType="hashMap" >
  			<!-- order="BEFORE" => insert 이전에 조회함 -->
  			<selectKey order="BEFORE" resultType="integer" keyProperty="bookId">
  				SELECT NVL(MAX(BOOK_ID),0)+1 FROM BOOK
  			</selectKey>
  			insert into book(BOOK_ID, TITLE, CATEGORY, PRICE, INSERT_DATE)
			values(
    				#{bookId}
    				, #{title}
    				, #{category}
    				, #{price}
    				, SYSDATE
				  )
  		</insert>
  		
  		<select id="select" parameterType="hashMap" resultType="hashMap">
			SELECT TITLE, CATEGORY, PRICE, INSERT_DATE FROM BOOK
			WHERE BOOK_ID = #{bookId}
  		</select>
  		
  		<update id="update" parameterType="hashMap">
  			UPDATE BOOK 
			SET TITLE = #{title}, 
     			CATEGORY = #{category}, 
      			PRICE = #{price} 
			WHERE BOOK_ID = #{bookId}
  		</update>
  		
  		<!-- 책 삭제 -->
  		<delete id="delete" parameterType="hashMap">
			DELETE FROM BOOK
  			  WHERE  BOOK_ID = #{bookId}
  		</delete>
  		
  		<select id="selectList" resultType="hashMap">
			SELECT BOOK_ID, TITLE, CATEGORY, PRICE, INSERT_DATE
			FROM BOOK
			ORDER BY INSERT_DATE DESC
  		</select>
  </mapper>